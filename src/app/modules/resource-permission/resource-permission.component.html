<mat-card class="m-3 mat-elevation-z4">
  <mat-card-header>
    <mat-card-title>Resource Permissions</mat-card-title>
  </mat-card-header>
  <mat-card-content>
    <div class="d-flex justify-content-between ml-3">
      <div>
        <mat-form-field *ngIf="dataSource.page$ | async as page">
          <mat-label>Filter</mat-label>
          <input (ngModelChange)="dataSource.queryTrigger($event)" [ngModel]="page.query" autocomplete="off" matInput>
          <mat-icon matSuffix>search</mat-icon>
        </mat-form-field>
      </div>
      <div class="d-flex justify-content-end">
        <div class="mr-3">
          <button [disabled]="dataSource.selection.selected.length === 0" [matMenuTriggerFor]="tableActionsMenu"
                  color="accent"
                  mat-raised-button>{{dataSource.selection.selected.length}}
            Selected
          </button>
          <mat-menu #tableActionsMenu="matMenu">
            <button (click)="deleteSelected()" mat-menu-item>
              <mat-icon>delete</mat-icon>
              <span>Delete selected</span>
            </button>
            <button mat-menu-item>Item 2</button>
          </mat-menu>
        </div>
        <button (click)="createDialog()" aria-label="Create" color="primary" mat-mini-fab>
          <mat-icon>add</mat-icon>
        </button>
      </div>
    </div>


    <mat-table (matSortChange)="dataSource.sortingTrigger($event)"
               [dataSource]="dataSource" [matSortActive]="sort.active"
               [matSortDirection]="sort.direction" matSort>

      <ng-container matColumnDef="select">
        <mat-header-cell *matHeaderCellDef>
          <mat-checkbox (change)="$event ? dataSource.masterToggle() : null"
                        [checked]="dataSource.selection.hasValue() && dataSource.isAllSelected()"
                        [indeterminate]="dataSource.selection.hasValue() && !dataSource.isAllSelected()"
          ></mat-checkbox>
        </mat-header-cell>
        <mat-cell *matCellDef="let row">
          <mat-checkbox (change)="$event ? dataSource.selection.toggle(row) : null"
                        (click)="$event.stopPropagation()"
                        [checked]="dataSource.selection.isSelected(row)"
          ></mat-checkbox>
        </mat-cell>
      </ng-container>

      <ng-container matColumnDef="_id">
        <mat-header-cell *matHeaderCellDef mat-sort-header>Id</mat-header-cell>
        <mat-cell *matCellDef="let row" (dblclick)="editDialog(row)">{{row._id}}</mat-cell>
      </ng-container>

      <ng-container matColumnDef="resourceName">
        <mat-header-cell *matHeaderCellDef mat-sort-header>ResourceName</mat-header-cell>
        <mat-cell *matCellDef="let row" (dblclick)="editDialog(row)">{{row.resourceName}}</mat-cell>
      </ng-container>

      <ng-container matColumnDef="methods">
        <mat-header-cell *matHeaderCellDef mat-sort-header>Methods</mat-header-cell>
        <mat-cell *matCellDef="let row" (dblclick)="editDialog(row)">
          <mat-list dense *ngIf="row.methods.length > 0" class="cell-mat-list">
            <mat-list-item *ngFor="let method of row.methods">{{method.name}} |
              <ng-container *ngFor="let role of method.roles; last as isLast">{{role.name}}<ng-container *ngIf="!isLast">,&nbsp;</ng-container></ng-container>
            </mat-list-item>
          </mat-list>
        </mat-cell>
      </ng-container>



<!--      <ng-container *ngFor="let column of columns | slice:1" [matColumnDef]="column.columnDef">-->
<!--        <mat-header-cell *matHeaderCellDef mat-sort-header>{{ column.header }}</mat-header-cell>-->

<!--        <mat-cell (dblclick)="editDialog(row)" *matCellDef="let row" [ngSwitch]="column.type">-->
<!--          <ng-container *ngSwitchCase="'string'||'number'">{{ row[column.columnDef]}}</ng-container>-->
<!--          <ng-container *ngSwitchCase="'date'">{{ row[column.columnDef] | date}}</ng-container>-->
<!--          <ng-container *ngSwitchCase="'Object[]'">-->
<!--            <mat-list dense>-->
<!--              <mat-list-item *ngFor="let item of row[column.columnDef];">-->
<!--                <ng-container *ngFor="let propertyItem of item | keyvalue; last as isLast" [ngSwitch]="getTypeOf(propertyItem.value)">-->
<!--                  <ng-container *ngSwitchCase="'string'">{{propertyItem.key}}: {{propertyItem.value}}<ng-container *ngIf="!isLast"> | </ng-container></ng-container>-->
<!--                  <ng-container *ngSwitchCase="'array'">-->
<!--                    {{propertyItem.key}}:<ng-container *ngFor="let nestedItem of propertyItem.value;last as nestedItemLast"> {{nestedItem.name}}<ng-container *ngIf="!nestedItemLast">, </ng-container></ng-container>-->
<!--                    <ng-container *ngIf="!isLast"> | </ng-container>-->
<!--                  </ng-container>-->
<!--                </ng-container>-->
<!--              </mat-list-item>-->
<!--            </mat-list>-->
<!--          </ng-container>-->
          <!--          <ng-container *ngSwitchCase="'array'">-->
          <!--            <ng-container *ngFor="let item of row[column.columnDef]">-->
          <!--              <a [href]="item.url" target="_blank">-->
          <!--                <img *ngIf="item.thumbnail else fileIcon" [matTooltip]="item.url" [src]="item.thumbnail.url" alt="" class="mr-1"-->
          <!--                     height="24px" width="24px">-->
          <!--                <ng-template #fileIcon>-->
          <!--                  <mat-icon [matTooltip]="item.url">file_download</mat-icon>-->
          <!--                </ng-template>-->
          <!--              </a>-->
          <!--            </ng-container>-->
          <!--          </ng-container>-->
<!--          <ng-container *ngSwitchDefault>{{ row[column.columnDef]}}</ng-container>-->
<!--        </mat-cell>-->
<!--      </ng-container>-->

      <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>
      <mat-row *matRowDef="let row; columns: displayedColumns;"></mat-row>

    </mat-table>
    <mat-paginator (page)="dataSource.paginationTrigger($event.pageIndex, $event.pageSize)"
                   *ngIf="dataSource.page$ | async as page" [length]="page.totalItems"
                   [pageIndex]="page.pageNumber" [pageSizeOptions]="[5, 10, 20, 50]"
                   [pageSize]="page.pageSize" showFirstLastButtons>
    </mat-paginator>
  </mat-card-content>
</mat-card>
